<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>UB Weather & PM2.5 Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    canvas { max-width: 900px; margin: 40px auto; display: block; }
    h1, p { text-align: center; }
  </style>
</head>
<body>
  <h1>UB Weather & Air Quality</h1>
  <p>Live data from weather.gov.mn and embassy PM2.5 monitors</p>
  <p><a href="weather_log.csv" download>Download CSV</a></p>

  <canvas id="pmChart"></canvas>

  <script>
    async function loadCSV() {
      const res = await fetch('weather_log.csv');
      const text = await res.text();
      const rows = text.trim().split('\n').slice(1); // skip header

      const timestamps = [];
      const french = [];
      const czech = [];
      const yarmag = [];

      for (const row of rows) {
        const cols = row.split(',');
        timestamps.push(cols[0]);
        french.push(parseFloat(cols[6]));  // French Embassy PM2.5
        czech.push(parseFloat(cols[7]));   // Czech Embassy PM2.5
        yarmag.push(parseFloat(cols[8]));  // Yarmag Garden City PM2.5
      }

      new Chart(document.getElementById('pmChart'), {
        type: 'line',
        data: {
          labels: timestamps,
          datasets: [
            { label: 'French Embassy PM2.5', data: french, borderColor: 'green', fill: false },
            { label: 'Czech Embassy PM2.5', data: czech, borderColor: 'orange', fill: false },
            { label: 'Yarmag Garden City PM2.5', data: yarmag, borderColor: 'purple', fill: false }
          ]
        },
        options: {
          responsive: true,
          interaction: { mode: 'index', intersect: false },
          plugins: {
            tooltip: { enabled: true },
            legend: { position: 'top' }
          },
          scales: {
            x: { title: { display: true, text: 'Timestamp' } },
            y: { title: { display: true, text: 'PM2.5 (µg/m³)' } }
          }
        }
      });
    }

    loadCSV();
    setInterval(loadCSV, 1800000); // refresh every 30 minutes
  </script>
</body>
</html>
